
> cocov@3.3.6 test:coverage
> vitest run --coverage


 RUN  v1.6.1 /Users/lg/lab/cocov
      Coverage enabled with v8

 âœ“ src/core/badges/generator.test.ts  (14 tests) 3ms
 âœ“ src/markdown-generator.test.ts  (6 tests) 2ms
 âœ“ src/git-utils.test.ts  (8 tests) 6ms
stdout | src/commands/badge.test.ts > badgeAction > generates lines badge by default
âœ” Badge generated: cocov-badge-lines.svg

stdout | src/commands/badge.test.ts > badgeAction > generates specific badge type
âœ” Badge generated: cocov-badge-branches.svg

stdout | src/commands/badge.test.ts > badgeAction > generates unified badge
âœ” Unified Badge generated: cocov-badge-unified.svg

stdout | src/commands/badge.test.ts > badgeAction > generates diff badge
âœ” Diff Badge generated: cocov-badge-diff-lines.svg

stdout | src/commands/badge.test.ts > badgeAction > generates diff badge with no baseline (warns)
âœ” Diff Badge generated: cocov-badge-diff-lines.svg

stdout | src/commands/badge.test.ts > badgeAction > generates all badges
âœ” Badge generated: cocov-badge-lines.svg
âœ” Badge generated: cocov-badge-statements.svg
âœ” Badge generated: cocov-badge-functions.svg
âœ” Badge generated: cocov-badge-branches.svg
âœ” Badge generated: cocov-badge-unified.svg
âœ” Badge generated: cocov-badge-diff-lines.svg
âœ” Badge generated: cocov-badge-diff-statements.svg
âœ” Badge generated: cocov-badge-diff-functions.svg
âœ” Badge generated: cocov-badge-diff-branches.svg

stdout | src/commands/badge.test.ts > badgeAction > handles output option for single badge
âœ” Badge generated: custom.svg

stdout | src/commands/badge.test.ts > badgeAction > handles output option for unified badge
âœ” Unified Badge generated: custom-u.svg

stdout | src/commands/badge.test.ts > badgeAction > handles output option for all badges (prefix)
âœ” Badge generated: custom-lines.svg
âœ” Badge generated: custom-statements.svg
âœ” Badge generated: custom-functions.svg
âœ” Badge generated: custom-branches.svg
âœ” Badge generated: custom-unified.svg
âœ” Badge generated: custom-diff-lines.svg
âœ” Badge generated: custom-diff-statements.svg
âœ” Badge generated: custom-diff-functions.svg
âœ” Badge generated: custom-diff-branches.svg

stdout | src/commands/badge.test.ts > badgeAction > generates logo badge
âœ” Badge generated: cocov-badge-logo.svg

stdout | src/commands/badge.test.ts > badgeAction > defaults to lines for unknown type
âœ” Badge generated: cocov-badge-unknown.svg

 âœ“ src/commands/badge.test.ts  (12 tests) 11ms
stdout | src/core/init/scaffold.test.ts > scaffoldConfig > creates .cocov/config.json

âœ” Created /cwd/.cocov/config.json

stdout | src/core/init/scaffold.test.ts > scaffoldConfig > creates .cocov/config.json without stack if disabled

âœ” Created /cwd/.cocov/config.json

stdout | src/core/init/scaffold.test.ts > scaffoldConfig > appends coverage flags for vitest

âœ” Created /cwd/.cocov/config.json

stdout | src/core/init/scaffold.test.ts > scaffoldConfig > appends coverage flags for jest

âœ” Created /cwd/.cocov/config.json

stdout | src/core/init/scaffold.test.ts > scaffoldConfig > uses default stack config when enabled but no deps provided

âœ” Created /cwd/.cocov/config.json

stdout | src/core/init/scaffold.test.ts > setupHusky > installs and inits husky
Installing Husky...
âœ” Created hardened pre-commit hook

stdout | src/core/init/scaffold.test.ts > setupHusky > configures pre-push hook
Installing Husky...
âœ” Created hardened pre-push hook

stdout | src/core/init/scaffold.test.ts > setupHusky > handles errors gracefully
Installing Husky...

stdout | src/core/init/scaffold.test.ts > setupHusky > handles non-Error exceptions
Installing Husky...

stdout | src/core/init/scaffold.test.ts > setupHusky > skips unknown hooks
Installing Husky...

stdout | src/core/init/scaffold.test.ts > setupHusky > appends to hook if it exists but missing cocov
Installing Husky...
âœ” Injected Cocov Guard into pre-commit

stdout | src/core/init/scaffold.test.ts > setupGithub > creates workflow file

âœ” Created GitHub Action at /cwd/.github/workflows/cocov.yml

stdout | src/core/init/scaffold.test.ts > updateGitIgnore > creates .gitignore if missing
âœ” Created .gitignore with .cocov

stdout | src/core/init/scaffold.test.ts > updateGitIgnore > appends to .gitignore if exists but missing entry
âœ” Added .cocov to .gitignore

stdout | src/core/init/scaffold.test.ts > updateGitIgnore > skips appending if entry already exists
â„¹ .cocov already in .gitignore

stdout | src/core/init/scaffold.test.ts > setupGithub idempotency > skips if workflow already exists
GitHub Action already exists. Skipping.

stdout | src/cli.test.ts > cli > creates program with correct name and version
     .....:--:.....     
   .:.:::------:::.:.   
 .:-:::---------.::.-:. 
.-==:.::..::::..:..:==-.
.:-=+*+::::::::::+*++=:.
    ...:   ..  ::...    
        ...:....        
        .-----:.        
      .....::----:      
     ..::---------.     
   ..........:------.   
    ....::---------..   


ğŸš€ Welcome to Cocov: The Code Coverage Gate


stdout | src/cli.test.ts > cli > triggers init command
     .....:--:.....     
   .:.:::------:::.:.   
 .:-:::---------.::.-:. 
.-==:.::..::::..:..:==-.
.:-=+*+::::::::::+*++=:.
    ...:   ..  ::...    
        ...:....        
        .-----:.        
      .....::----:      
     ..::---------.     
   ..........:------.   
    ....::---------..   


ğŸš€ Welcome to Cocov: The Code Coverage Gate


stdout | src/cli.test.ts > cli > triggers run command
     .....:--:.....     
   .:.:::------:::.:.   
 .:-:::---------.::.-:. 
.-==:.::..::::..:..:==-.
.:-=+*+::::::::::+*++=:.
    ...:   ..  ::...    
        ...:....        
        .-----:.        
      .....::----:      
     ..::---------.     
   ..........:------.   
    ....::---------..   


ğŸš€ Welcome to Cocov: The Code Coverage Gate


stdout | src/cli.test.ts > cli > triggers html command
     .....:--:.....     
   .:.:::------:::.:.   
 .:-:::---------.::.-:. 
.-==:.::..::::..:..:==-.
.:-=+*+::::::::::+*++=:.
    ...:   ..  ::...    
        ...:....        
        .-----:.        
      .....::----:      
     ..::---------.     
   ..........:------.   
    ....::---------..   


ğŸš€ Welcome to Cocov: The Code Coverage Gate


stdout | src/cli.test.ts > cli > triggers badge command
     .....:--:.....     
   .:.:::------:::.:.   
 .:-:::---------.::.-:. 
.-==:.::..::::..:..:==-.
.:-=+*+::::::::::+*++=:.
    ...:   ..  ::...    
        ...:....        
        .-----:.        
      .....::----:      
     ..::---------.     
   ..........:------.   
    ....::---------..   


ğŸš€ Welcome to Cocov: The Code Coverage Gate


 âœ“ src/core/init/scaffold.test.ts  (21 tests) 19ms
stdout | src/cli.test.ts > cli > triggers inject-readme command
     .....:--:.....     
   .:.:::------:::.:.   
 .:-:::---------.::.-:. 
.-==:.::..::::..:..:==-.
.:-=+*+::::::::::+*++=:.
    ...:   ..  ::...    
        ...:....        
        .-----:.        
      .....::----:      
     ..::---------.     
   ..........:------.   
    ....::---------..   


ğŸš€ Welcome to Cocov: The Code Coverage Gate


 âœ“ src/core/coverage/io.test.ts  (10 tests) 21ms
stdout | src/cli.test.ts > cli > handles init failure
     .....:--:.....     
   .:.:::------:::.:.   
 .:-:::---------.::.-:. 
.-==:.::..::::..:..:==-.
.:-=+*+::::::::::+*++=:.
    ...:   ..  ::...    
        ...:....        
        .-----:.        
      .....::----:      
     ..::---------.     
   ..........:------.   
    ....::---------..   


ğŸš€ Welcome to Cocov: The Code Coverage Gate


stdout | src/cli.test.ts > cli > handles unknown init errors
     .....:--:.....     
   .:.:::------:::.:.   
 .:-:::---------.::.-:. 
.-==:.::..::::..:..:==-.
.:-=+*+::::::::::+*++=:.
    ...:   ..  ::...    
        ...:....        
        .-----:.        
      .....::----:      
     ..::---------.     
   ..........:------.   
    ....::---------..   


ğŸš€ Welcome to Cocov: The Code Coverage Gate


 âœ“ src/cli.test.ts  (8 tests) 24ms
stdout | src/commands/init.test.ts > runInit > runs full init workflow

                      --::=-                       
                 ::-==:::::-==::                   
               :::===::::::::===:::                
             :::-===:::::::::-===:::               
             .......=========-......:              
                  .:=   ==  ==:                    
                      .::===                       
                     ::::::--                      
                  ----:::::::::                    
                 ===========-::::                  
                =======-:::::::::                  
                  =: :::::::::::                   
  

ğŸš€ Welcome to Cocov: The Code Coverage Gate


      âœ¨ Cocov Configuration Complete! âœ¨
  

  Next Steps:
  
  1. Review your configuration:
     cat .cocov/config.json

  2. Run your first coverage check:
     npx cocov run

  3. (Optional) Visualize your coverage history:
     npx cocov history

  For more documentation, visit:
  https://github.com/lguibr/cocov
  

       _..._
     .'     '.
    /  _   _  \
    | (o)_(o) |
    |   (_)   |   Protection Active!
    /    _    \
   /    | |    \
  (____/   \____)
  

stdout | src/commands/init.test.ts > runInit > detects defaults when package.json missing

                      --::=-                       
                 ::-==:::::-==::                   
               :::===::::::::===:::                
             :::-===:::::::::-===:::               
             .......=========-......:              
                  .:=   ==  ==:                    
                      .::===                       
                     ::::::--                      
                  ----:::::::::                    
                 ===========-::::                  
                =======-:::::::::                  
                  =: :::::::::::                   
  

ğŸš€ Welcome to Cocov: The Code Coverage Gate


      âœ¨ Cocov Configuration Complete! âœ¨
  

  Next Steps:
  
  1. Review your configuration:
     cat .cocov/config.json

  2. Run your first coverage check:
     npx cocov run

  3. (Optional) Visualize your coverage history:
     npx cocov history

  For more documentation, visit:
  https://github.com/lguibr/cocov
  

       _..._
     .'     '.
    /  _   _  \
    | (o)_(o) |
    |   (_)   |   Protection Active!
    /    _    \
   /    | |    \
  (____/   \____)
  

stdout | src/commands/init.test.ts > runInit > detects defaults with error reading package.json

                      --::=-                       
                 ::-==:::::-==::                   
               :::===::::::::===:::                
             :::-===:::::::::-===:::               
             .......=========-......:              
                  .:=   ==  ==:                    
                      .::===                       
                     ::::::--                      
                  ----:::::::::                    
                 ===========-::::                  
                =======-:::::::::                  
                  =: :::::::::::                   
  

ğŸš€ Welcome to Cocov: The Code Coverage Gate


      âœ¨ Cocov Configuration Complete! âœ¨
  

  Next Steps:
  
  1. Review your configuration:
     cat .cocov/config.json

  2. Run your first coverage check:
     npx cocov run

  3. (Optional) Visualize your coverage history:
     npx cocov history

  For more documentation, visit:
  https://github.com/lguibr/cocov
  

       _..._
     .'     '.
    /  _   _  \
    | (o)_(o) |
    |   (_)   |   Protection Active!
    /    _    \
   /    | |    \
  (____/   \____)
  

stdout | src/commands/init.test.ts > runInit > detects vitest runner

                      --::=-                       
                 ::-==:::::-==::                   
               :::===::::::::===:::                
             :::-===:::::::::-===:::               
             .......=========-......:              
                  .:=   ==  ==:                    
                      .::===                       
                     ::::::--                      
                  ----:::::::::                    
                 ===========-::::                  
                =======-:::::::::                  
                  =: :::::::::::                   
  

ğŸš€ Welcome to Cocov: The Code Coverage Gate


      âœ¨ Cocov Configuration Complete! âœ¨
  

  Next Steps:
  
  1. Review your configuration:
     cat .cocov/config.json

  2. Run your first coverage check:
     npx cocov run

  3. (Optional) Visualize your coverage history:
     npx cocov history

  For more documentation, visit:
  https://github.com/lguibr/cocov
  

       _..._
     .'     '.
    /  _   _  \
    | (o)_(o) |
    |   (_)   |   Protection Active!
    /    _    \
   /    | |    \
  (____/   \____)
  

stdout | src/commands/init.test.ts > runInit > detects jest runner

                      --::=-                       
                 ::-==:::::-==::                   
               :::===::::::::===:::                
             :::-===:::::::::-===:::               
             .......=========-......:              
                  .:=   ==  ==:                    
                      .::===                       
                     ::::::--                      
                  ----:::::::::                    
                 ===========-::::                  
                =======-:::::::::                  
                  =: :::::::::::                   
  

ğŸš€ Welcome to Cocov: The Code Coverage Gate


      âœ¨ Cocov Configuration Complete! âœ¨
  

  Next Steps:
  
  1. Review your configuration:
     cat .cocov/config.json

  2. Run your first coverage check:
     npx cocov run

  3. (Optional) Visualize your coverage history:
     npx cocov history

  For more documentation, visit:
  https://github.com/lguibr/cocov
  

       _..._
     .'     '.
    /  _   _  \
    | (o)_(o) |
    |   (_)   |   Protection Active!
    /    _    \
   /    | |    \
  (____/   \____)
  

stdout | src/commands/init.test.ts > runInit > prefers existing test script

                      --::=-                       
                 ::-==:::::-==::                   
               :::===::::::::===:::                
             :::-===:::::::::-===:::               
             .......=========-......:              
                  .:=   ==  ==:                    
                      .::===                       
                     ::::::--                      
                  ----:::::::::                    
                 ===========-::::                  
                =======-:::::::::                  
                  =: :::::::::::                   
  

ğŸš€ Welcome to Cocov: The Code Coverage Gate


      âœ¨ Cocov Configuration Complete! âœ¨
  

  Next Steps:
  
  1. Review your configuration:
     cat .cocov/config.json

  2. Run your first coverage check:
     npx cocov run

  3. (Optional) Visualize your coverage history:
     npx cocov history

  For more documentation, visit:
  https://github.com/lguibr/cocov
  

       _..._
     .'     '.
    /  _   _  \
    | (o)_(o) |
    |   (_)   |   Protection Active!
    /    _    \
   /    | |    \
  (____/   \____)
  

stdout | src/commands/init.test.ts > runInit > aborts on cancellation

                      --::=-                       
                 ::-==:::::-==::                   
               :::===::::::::===:::                
             :::-===:::::::::-===:::               
             .......=========-......:              
                  .:=   ==  ==:                    
                      .::===                       
                     ::::::--                      
                  ----:::::::::                    
                 ===========-::::                  
                =======-:::::::::                  
                  =: :::::::::::                   
  

ğŸš€ Welcome to Cocov: The Code Coverage Gate


 âœ“ src/commands/inject-readme.test.ts  (6 tests) 18ms
 â¯ src/commands/init.test.ts  (7 tests | 4 failed) 13ms
   â¯ src/commands/init.test.ts > runInit > detects defaults with error reading package.json
     â†’ expected "askInitQuestions" to be called with arguments: [ false, ObjectContaining{â€¦} ]

Received: 

  1st askInitQuestions call:

  Array [
-   false,
-   ObjectContaining {
+   true,
+   Object {
      "runner": "other",
      "testCommand": "npm test",
    },
  ]


Number of calls: 1

   â¯ src/commands/init.test.ts > runInit > detects vitest runner
     â†’ expected "askInitQuestions" to be called with arguments: [ false, ObjectContaining{â€¦} ]

Received: 

  1st askInitQuestions call:

  Array [
-   false,
-   ObjectContaining {
+   true,
+   Object {
      "runner": "vitest",
      "testCommand": "npx vitest run",
    },
  ]


Number of calls: 1

   â¯ src/commands/init.test.ts > runInit > detects jest runner
     â†’ expected "askInitQuestions" to be called with arguments: [ false, ObjectContaining{â€¦} ]

Received: 

  1st askInitQuestions call:

  Array [
-   false,
-   ObjectContaining {
+   true,
+   Object {
      "runner": "jest",
      "testCommand": "npx jest",
    },
  ]


Number of calls: 1

   â¯ src/commands/init.test.ts > runInit > prefers existing test script
     â†’ expected "askInitQuestions" to be called with arguments: [ false, ObjectContaining{â€¦} ]

Received: 

  1st askInitQuestions call:

  Array [
-   false,
-   ObjectContaining {
+   true,
+   Object {
      "runner": "vitest",
      "testCommand": "npm test",
    },
  ]


Number of calls: 1

stdout | src/commands/run.test.ts > runAction > runs test command and handles baseline
Running test command: npm test...

stdout | src/commands/run.test.ts > runAction > enforces stack guard if enabled
Running test command: npm test...

stdout | src/commands/run.test.ts > runAction > runs diff check if enabled
Running test command: npm test...

stdout | src/commands/run.test.ts > runAction > handles dry run
Running test command: npm test...
ğŸš§ DRY RUN MODE: No baseline updates.

stdout | src/commands/run.test.ts > runAction > handles errors gracefully
Running test command: npm test...

stdout | src/commands/run.test.ts > runAction > handles unknown errors
Running test command: npm test...

stdout | src/commands/run.test.ts > runAction > handles ThresholdError
Running test command: npm test...

 âœ“ src/commands/run.test.ts  (7 tests) 8ms
stdout | src/core/logic/baseline-handler.test.ts > handleBaselineCheck > writes baseline if none exists (not dry run)
No baseline found. Saving current coverage as baseline.

stdout | src/core/logic/baseline-handler.test.ts > handleBaselineCheck > does not write baseline if none exists (dry run)
No baseline found. (Dry Run: Not saving).

stdout | src/core/logic/baseline-handler.test.ts > handleBaselineCheck > exits on regression

Coverage unchanged.

stdout | src/core/logic/baseline-handler.test.ts > handleBaselineCheck > updates baseline on improvement

âœ” Coverage improved! Updating baseline.

stdout | src/core/logic/baseline-handler.test.ts > handleBaselineCheck > does not update baseline on improvement (dry run)

âœ” Coverage improved! (Dry Run: Baseline NOT updated).

 âœ“ src/core/logic/baseline-handler.test.ts  (6 tests) 18ms
stdout | src/stack-guard.test.ts > StackGuard > check > passes when requirements met
Running Stack Guard...
âœ” Stack Check Passed

stdout | src/stack-guard.test.ts > StackGuard > check > fails when required dep missing
Running Stack Guard...

stdout | src/stack-guard.test.ts > StackGuard > check > fails when forbidden dep present
Running Stack Guard...

stdout | src/stack-guard.test.ts > StackGuard > check > passes if no stack config
Running Stack Guard...
âœ” Stack Check Passed

stdout | src/stack-guard.test.ts > StackGuard > check > warns if tsconfig missing
Running Stack Guard...
âœ” Stack Check Passed

stdout | src/stack-guard.test.ts > StackGuard > check > fails if package.json missing
Running Stack Guard...

 âœ“ src/stack-guard.test.ts  (6 tests) 8ms
 âœ“ src/core/init/questions.test.ts  (3 tests) 7ms
stdout | src/core/init/questions.test.ts > askInitQuestions > prompts for overwrite if config exists
Running questions test case 1
DEBUG: askInitQuestions executing

stdout | src/core/init/questions.test.ts > askInitQuestions > skips prompts if config does not exist
Running questions test case 2
DEBUG: askInitQuestions executing

stdout | src/core/init/questions.test.ts > askInitQuestions > validates prompt definitions
DEBUG: askInitQuestions executing

 âœ“ src/core/logic/diff-parser.spec.ts  (20 tests) 5ms
 âœ“ src/history.test.ts  (4 tests) 6ms
 âœ“ src/core/logic/threshold-coverage.test.ts  (4 tests) 4ms
stdout | src/commands/markdown.test.ts > markdownAction > generates markdown file
âœ” Markdown report generated at .cocov/reports/summary.md

stdout | src/commands/markdown.test.ts > markdownAction > injects into README when option provided
âœ” Injected report into README.md

stdout | src/commands/markdown.test.ts > markdownAction > logs warning if injection fails
âš  Could not find injection markers in README.md
  Add <!-- cocov-start --> and <!-- cocov-end --> to your file.

 âœ“ src/commands/markdown.test.ts  (4 tests) 11ms
 âœ“ src/utils/banner.test.ts  (3 tests) 4ms
 âœ“ src/core/logic/comparator.spec.ts  (400 tests) 46ms
 âœ“ src/reporter.test.ts  (2 tests) 11ms
 âœ“ src/core/logic/threshold-validator.test.ts  (3 tests) 4ms
 âœ“ src/core/logic/diff-checker.test.ts  (4 tests) 183ms
 âœ“ src/core/logic/threshold-gate.test.ts  (3 tests) 3ms
stdout | src/commands/debug-html.test.ts > Debug HTML > runs html action
Running HTML Action...
âœ” HTML report generated at .cocov/reports/index.html
Done HTML Action

 âœ“ src/commands/debug-html.test.ts  (2 tests) 5ms
 âœ“ src/core/integrity.test.ts  (4 tests) 6ms
 âœ“ src/executor.test.ts  (2 tests) 4ms
 âœ“ src/injector.test.ts  (3 tests) 6ms
stdout | src/core/logic/diff-runner.test.ts > runDiffCheck > skips if detailed coverage missing

ğŸ” Running Diff-Aware Strict Mode...

stdout | src/core/logic/diff-runner.test.ts > runDiffCheck > passes if no diffs

ğŸ” Running Diff-Aware Strict Mode...
âœ” Diff Strict Mode Passed: All changes covered.

stdout | src/core/logic/diff-runner.test.ts > runDiffCheck > exits if uncovered changes

ğŸ” Running Diff-Aware Strict Mode...

 âœ“ src/core/logic/diff-runner.test.ts  (3 tests) 4ms
 âœ“ src/core/html/generator.test.ts  (1 test) 1ms

 Test Files  1 failed | 28 passed (29)
      Tests  4 failed | 572 passed (576)
   Start at  14:04:30
   Duration  1.04s (transform 817ms, setup 2ms, collect 2.61s, tests 461ms, environment 11ms, prepare 2.71s)

